{
  "version": 3,
  "sources": ["../../../../extensions/better-web-pixle-analytics/src/index.js"],
  "sourceRoot": "/Users/zamartz/Sites/Github/better-shopify-analytics/extensions/better-web-pixle-analytics/src",
  "sourcesContent": ["// Web Pixel Extension for Better Analytics\n// This extension checks for Google Analytics cookies and logs matching GA4 sessions\n\n/**\n * @typedef {import(\"../generated/api\").InputQuery} InputQuery\n * @typedef {import(\"../generated/api\").FunctionResult} FunctionResult\n * @typedef {import(\"../generated/api\").API} API\n */\n\n// First log entry to confirm script loaded\nconsole.log(\"BETTER ANALYTICS: SCRIPT LOADED\", { timestamp: new Date().toISOString() });\n\n/**\n * @type {API}\n */\nexport const api = {};\n\n/**\n * Standard web pixel entry point - this will be executed when the pixel is loaded\n */\nexport function run(context) {\n  // Log pixel initialization\n  console.log(\"BETTER ANALYTICS: INITIALIZED\", { \n    ga4Id: context.settings?.ga4AccountId,\n    timestamp: new Date().toISOString() \n  });\n\n  // Subscribe to page_view events\n  context.analytics.subscribe('page_view', (payload) => {\n    // Log page view with clear formatting and data\n    console.log(\"BETTER ANALYTICS: PAGE_VIEW EVENT\", {\n      url: window.location.href,\n      timestamp: new Date().toISOString(),\n      ga4Id: context.settings?.ga4AccountId\n    });\n    \n    // Return success to indicate event was handled\n    return { success: true };\n  });\n  \n  // Subscribe to connection_check event (required for \"Connected\" status)\n  context.analytics.subscribe('connection_check', (payload) => {\n    console.log(\"BETTER ANALYTICS: CONNECTION_CHECK EVENT\");\n    return { connected: true };\n  });\n  \n  // Return promise to complete initialization\n  return Promise.resolve();\n}\n\n/**\n * Register function for the web pixel\n */\nexport function register(api) {\n  console.log(\"=== BETTER ANALYTICS: REGISTER FUNCTION CALLED ===\");\n  \n  try {\n    // Try to communicate with parent window\n    if (window.top && window.top !== window) {\n      window.top.postMessage({\n        type: \"BETTER_ANALYTICS_REGISTERED\",\n        ga4Id: api.settings?.ga4AccountId,\n        timestamp: new Date().toISOString()\n      }, \"*\");\n    }\n    \n    // Subscribe to page_viewed events\n    api.analytics.subscribe(\"page_viewed\", (event) => {\n      console.log(\"=== BETTER ANALYTICS: PAGE_VIEWED EVENT ===\");\n      \n      // Try to communicate the event to parent window\n      if (window.top && window.top !== window) {\n        window.top.postMessage({\n          type: \"BETTER_ANALYTICS_PAGE_VIEWED\",\n          url: event.context?.document?.location?.href,\n          timestamp: new Date().toISOString()\n        }, \"*\");\n      }\n      \n      return { success: true };\n    });\n    \n    // Subscribe to connection_check\n    api.analytics.subscribe(\"connection_check\", () => {\n      console.log(\"=== BETTER ANALYTICS: CONNECTION CHECK ===\");\n      return { connected: true };\n    });\n  } catch (error) {\n    console.error(\"=== BETTER ANALYTICS: REGISTER ERROR ===\", error);\n  }\n}"],
  "mappings": ";;AAUA,UAAQ,IAAI,mCAAmC,EAAE,YAAW,oBAAI,KAAK,GAAE,YAAY,EAAE,CAAC;",
  "names": []
}
